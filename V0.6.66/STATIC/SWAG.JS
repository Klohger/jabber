"use strict";var SOURCE_CONNECTOR,c=this&&this.__awaiter||function(e,o,l,c){return new(l=l||Promise)(function(t,r){function n(e){try{a(c.next(e))}catch(e){r(e)}}function i(e){try{a(c.throw(e))}catch(e){r(e)}}function a(e){var r;e.done?t(e.value):((r=e.value)instanceof l?r:new l(function(e){e(r)})).then(n,i)}a((c=c.apply(e,o||[])).next())})};!function(){function e(r,s){if(s&&s.multiple&&!Array.isArray(r))throw new Error("Invalid argument type: Expected an Array to serialize multiple values.");const u=4294967296;let d,T,n=new Uint8Array(128),i=0;if(s&&s.multiple)for(let e=0;e<r.length;e++)y(r[e]);else y(r);return n.subarray(0,i);function y(r,e){switch(typeof r){case"undefined":I();break;case"boolean":p(r?195:194);break;case"number":var t=r;isFinite(t)&&Math.floor(t)===t?0<=t&&t<=127||t<0&&-32<=t?p(t):0<t&&t<=255?h([204,t]):-128<=t&&t<=127?h([208,t]):0<t&&t<=65535?h([205,t>>>8,t]):-32768<=t&&t<=32767?h([209,t>>>8,t]):0<t&&t<=4294967295?h([206,t>>>24,t>>>16,t>>>8,t]):-2147483648<=t&&t<=2147483647?h([210,t>>>24,t>>>16,t>>>8,t]):0<t&&t<=0x10000000000000000?h([211,(n=t/u)>>>24,n>>>16,n>>>8,n,(i=t%u)>>>24,i>>>16,i>>>8,i]):-0x8000000000000000<=t&&t<=0x8000000000000000?(p(211),v(t)):h(t<0?[211,128,0,0,0,0,0,0,0]:[207,255,255,255,255,255,255,255,255]):(T||(d=new ArrayBuffer(8),T=new DataView(d)),T.setFloat64(0,t),p(203),h(new Uint8Array(d)));break;case"string":var n=r,i=(n=function(t){let r=!0,n=t.length;for(let e=0;e<n;e++)if(127<t.charCodeAt(e)){r=!1;break}let i=0,a=new Uint8Array(t.length*(r?1:4));for(let r=0;r!==n;r++){let e=t.charCodeAt(r);if(e<128)a[i++]=e;else{if(e<2048)a[i++]=e>>6|192;else{if(55295<e&&e<56320){if(++r>=n)throw new Error("UTF-8 encode: incomplete surrogate pair");var o=t.charCodeAt(r);if(o<56320||57343<o)throw new Error("UTF-8 encode: second surrogate character 0x"+o.toString(16)+" at index "+r+" out of range");e=65536+((1023&e)<<10)+(1023&o),a[i++]=e>>18|240,a[i++]=e>>12&63|128}else a[i++]=e>>12|224;a[i++]=e>>6&63|128}a[i++]=63&e|128}}return r?a:a.subarray(0,i)}(r)).length;i<=31?p(160+i):h(i<=255?[217,i]:i<=65535?[218,i>>>8,i]:[219,i>>>24,i>>>16,i>>>8,i]),h(n);break;case"object":if(null===r)I();else if(r instanceof Date){var a=(t=r).getTime()/1e3;0===t.getMilliseconds()&&0<=a&&a<4294967296?h([214,255,a>>>24,a>>>16,a>>>8,a]):0<=a&&a<17179869184?h([215,255,(o=1e6*t.getMilliseconds())>>>22,o>>>14,o>>>6,o<<2>>>0|a/u,a>>>24,a>>>16,a>>>8,a]):(h([199,12,255,(o=1e6*t.getMilliseconds())>>>24,o>>>16,o>>>8,o]),v(a))}else if(Array.isArray(r))S(r);else if(r instanceof Uint8Array||r instanceof Uint8ClampedArray){var o=r;h((a=o.length)<=15?[196,a]:a<=65535?[197,a>>>8,a]:[198,a>>>24,a>>>16,a>>>8,a]),h(o)}else if(r instanceof Int8Array||r instanceof Int16Array||r instanceof Uint16Array||r instanceof Int32Array||r instanceof Uint32Array||r instanceof Float32Array||r instanceof Float64Array)S(r);else{var l,c,f=r;let e=0;for(l in f)void 0!==f[l]&&e++;for(c in e<=15?p(128+e):e<=65535?h([222,e>>>8,e]):h([223,e>>>24,e>>>16,e>>>8,e]),f){var E=f[c];void 0!==E&&(y(c),y(E))}}break;default:if(e||!s||!s.invalidTypeReplacement)throw new Error("Invalid argument type: The type '"+typeof r+"' cannot be serialized.");"function"==typeof s.invalidTypeReplacement?y(s.invalidTypeReplacement(r),!0):y(s.invalidTypeReplacement,!0)}}function I(){p(192)}function S(r){var t=r.length;t<=15?p(144+t):h(t<=65535?[220,t>>>8,t]:[221,t>>>24,t>>>16,t>>>8,t]);for(let e=0;e<t;e++)y(r[e])}function p(e){if(n.length<i+1){let e=2*n.length;for(;e<i+1;)e*=2;var r=new Uint8Array(e);r.set(n),n=r}n[i]=e,i++}function h(r){if(n.length<i+r.length){let e=2*n.length;for(;e<i+r.length;)e*=2;var t=new Uint8Array(e);t.set(n),n=t}n.set(r,i),i+=r.length}function v(e){let r,t;t=0<=e?(r=e/u,e%u):(e++,r=Math.abs(e)/u,t=Math.abs(e)%u,r=~r,~t),h([r>>>24,r>>>16,r>>>8,r,t>>>24,t>>>16,t>>>8,t])}}function r(o,e){const i=4294967296;let l=0;if("object"!=typeof(o=o instanceof ArrayBuffer?new Uint8Array(o):o)||void 0===o.length)throw new Error("Invalid argument type: Expected a byte array (Array or Uint8Array) to deserialize.");if(!o.length)throw new Error("Invalid argument: The byte array to deserialize is empty.");o instanceof Uint8Array||(o=new Uint8Array(o));let r;if(e&&e.multiple)for(r=[];l<o.length;)r.push(n());else r=n();return r;function n(){var e=o[l++];if(0<=e&&e<=127)return e;if(128<=e&&e<=143)return E(e-128);if(144<=e&&e<=159)return s(e-144);if(160<=e&&e<=191)return u(e-160);if(192===e)return null;if(193===e)throw new Error("Invalid byte code 0xc1 found.");if(194===e)return!1;if(195===e)return!0;if(196===e)return f(-1,1);if(197===e)return f(-1,2);if(198===e)return f(-1,4);if(199===e)return d(-1,1);if(200===e)return d(-1,2);if(201===e)return d(-1,4);if(202===e)return t(4);if(203===e)return t(8);if(204===e)return c(1);if(205===e)return c(2);if(206===e)return c(4);if(207===e)return c(8);if(208===e)return a(1);if(209===e)return a(2);if(210===e)return a(4);if(211===e)return a(8);if(212===e)return d(1);if(213===e)return d(2);if(214===e)return d(4);if(215===e)return d(8);if(216===e)return d(16);if(217===e)return u(-1,1);if(218===e)return u(-1,2);if(219===e)return u(-1,4);if(220===e)return s(-1,2);if(221===e)return s(-1,4);if(222===e)return E(-1,2);if(223===e)return E(-1,4);if(224<=e&&e<=255)return e-256;throw console.debug("msgpack array:",o),new Error("Invalid byte value '"+e+"' at index "+(l-1)+" in the MessagePack binary data (length "+o.length+"): Expecting a range of 0 to 255. This is not a byte array.")}function a(e){let r=0,t=!0;for(;0<e--;){var n;t?(n=o[l++],r+=127&n,128&n&&(r-=128),t=!1):r=(r*=256)+o[l++]}return r}function c(e){let r=0;for(;0<e--;)r=(r*=256)+o[l++];return r}function t(e){var r=new DataView(o.buffer,l+o.byteOffset,e);return l+=e,4===e?r.getFloat32(0,!1):8===e?r.getFloat64(0,!1):void 0}function f(e,r){return e<0&&(e=c(r)),r=o.subarray(l,l+e),l+=e,r}function E(e,r){e<0&&(e=c(r));for(var t={};0<e--;)t[n()]=n();return t}function s(e,r){e<0&&(e=c(r));for(var t=[];0<e--;)t.push(n());return t}function u(e,n){e<0&&(e=c(n)),n=l,l+=e;{var i=o,a=e;let r=n,t="";for(a+=n;r<a;){let e=i[r++];if(127<e)if(191<e&&e<224){if(r>=a)throw new Error("UTF-8 decode: incomplete 2-byte sequence");e=(31&e)<<6|63&i[r++]}else if(223<e&&e<240){if(r+1>=a)throw new Error("UTF-8 decode: incomplete 3-byte sequence");e=(15&e)<<12|(63&i[r++])<<6|63&i[r++]}else{if(!(239<e&&e<248))throw new Error("UTF-8 decode: unknown multibyte start 0x"+e.toString(16)+" at index "+(r-1));if(r+2>=a)throw new Error("UTF-8 decode: incomplete 4-byte sequence");e=(7&e)<<18|(63&i[r++])<<12|(63&i[r++])<<6|63&i[r++]}if(e<=65535)t+=String.fromCharCode(e);else{if(!(e<=1114111))throw new Error("UTF-8 decode: code point 0x"+e.toString(16)+" exceeds UTF-16 reach");e-=65536,t=(t+=String.fromCharCode(e>>10|55296))+String.fromCharCode(1023&e|56320)}}return t}}function d(e,r){if(e<0&&(e=c(r)),r=c(1),e=f(e),255!==r)return{type:r,data:e};if(4===(r=e).length)return n=(r[0]<<24>>>0)+(r[1]<<16>>>0)+(r[2]<<8>>>0)+r[3],new Date(1e3*n);if(8===r.length)return n=(r[0]<<22>>>0)+(r[1]<<14>>>0)+(r[2]<<6>>>0)+(r[3]>>>2),t=(3&r[3])*i+(r[4]<<24>>>0)+(r[5]<<16>>>0)+(r[6]<<8>>>0)+r[7],new Date(1e3*t+n/1e6);if(12!==r.length)throw new Error("Invalid data length for a date value.");var t=(r[0]<<24>>>0)+(r[1]<<16>>>0)+(r[2]<<8>>>0)+r[3],n=(l-=8,a(8));return new Date(1e3*n+t/1e6)}}var t={serialize:e,deserialize:r,encode:e,decode:r};"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=t:window[window.msgpackJsName||"msgpack"]=t}(),function(){let r;const t=document.querySelector("#CONNECT_BUTTON"),i=document.querySelector("#THE_TABLE");let a;function o(e){r.send(msgpack.serialize(e))}const n=window.location.protocol.replace("http","ws")+window.location.host;function l(r){console.log(r);var e=document.createElement("table");e.innerHTML=`<tbody><tr class="VESSEL" moniker="${r}"><td class="STATUS OUT"><div class="IN DEFAULT_0"></div></td><td class="NAME OUT"><div class="CENTERER"><div>${r}</div></div></td><td class="MISSIVE_INPUT OUT CENTERER" style="display:inline-flex;"><input class="IN H2" type="text" placeholder="SEND MISSIVE..."><div class="BUTTON CENTERER">SEND</div></td><td class="RECORD_INPUT OUT" style="display:inline-flex;"><div class="BUTTON CENTERER">SEND RECORD</div><input type="file"></td></tr></tbody>`.trim();let t=e.firstElementChild.firstElementChild;t.querySelector(".MISSIVE_INPUT > .BUTTON").addEventListener("click",e=>{e.preventDefault();e=t.querySelector('.MISSIVE_INPUT > input[type="text"]').value.trim();""!==e&&o(Object.assign(Object.assign({},a),{TYPE:"SEND_MEDIA",RECIPIENT:r,MEDIA:{TYPE:"MISSIVE",TEXT:e.toUpperCase()}}))});const n=t.querySelector('.RECORD_INPUT > input[type="file"]');return n.addEventListener("change",()=>c(this,void 0,void 0,function*(){o({TYPE:"SEND_MEDIA",MONIKER:a.MONIKER,PASSWORD:a.PASSWORD,RECIPIENT:r,MEDIA:{TYPE:"RECORD",FILE_NAME:n.files.item(0).name,DATA:new Uint8Array(yield n.files.item(0).arrayBuffer())}})})),t.querySelector(".RECORD_INPUT > .BUTTON").addEventListener("click",e=>{e.preventDefault(),n.click()}),t}t.addEventListener("click",e=>c(this,void 0,void 0,function*(){e.preventDefault(),function(){(r=new WebSocket(n+"/THE_SOURCE")).onopen=e=>{o({TYPE:"REQUEST_INVITATION",SUGGESTED_MONIKER:(()=>{let e;for(;null===(e=prompt("yooo")););return e})()})},r.onmessage=n=>c(this,void 0,void 0,function*(){console.log(n.data);var e=msgpack.deserialize(new Uint8Array(yield n.data.arrayBuffer()));switch(console.log("Recieved:",e),e.TYPE){case"INVITATION_REQUEST_RESPONSE":switch(e.RESPONSE.TYPE){case"INVITATION":e.RESPONSE.OTHER_VESSELS.forEach(e=>i.appendChild(l(e))),a={MONIKER:e.RESPONSE.MONIKER,PASSWORD:e.RESPONSE.PASSWORD};break;case"MONIKER_TAKEN":o({TYPE:"REQUEST_INVITATION",SUGGESTED_MONIKER:(()=>{let e;for(;null===(e=prompt("yooo")););return e})()});break;case"TOO_COMPLEX":o({TYPE:"REQUEST_INVITATION",SUGGESTED_MONIKER:(()=>{let e;for(;null===(e=prompt("yooo")););return e})()})}break;case"RECIEVE_MEDIA":switch(e.MEDIA.TYPE){case"MISSIVE":alert(`RECIEVED MISSIVE FROM "${e.MONIKER}":`+e.MEDIA.TEXT);break;case"RECORD":alert(`RECIEVED RECORD "${e.MEDIA.FILE_NAME}" FROM "${e.MONIKER}". Downloading...`);var r=document.createElement("a"),t=new Blob([new Uint8Array(e.MEDIA.DATA)]);r.href=URL.createObjectURL(t),r.download=e.MEDIA.FILE_NAME,r.click(),r.remove()}break;case"VESSEL_ENTERED":i.appendChild(l(e.MONIKER));break;case"VESSEL_LEFT":document.querySelector(`.VESSEL[moniker="${e.MONIKER}"]`).remove();break;case"DISCONNECT":o({TYPE:"REQUEST_INVITATION",SUGGESTED_MONIKER:(()=>{let e;for(;null===(e=prompt("yooo")););return e})()})}})}(),t.style.display="none"}))}(SOURCE_CONNECTOR=SOURCE_CONNECTOR||{});